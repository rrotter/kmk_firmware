name: Compile .mpy files
run-name: Compile ${{ github.sha }}
on:
  push:
    branches: ['main', 'master']
env:
  mpy-cross-uri: "https://adafruit-circuit-python.s3.amazonaws.com/bin/mpy-cross/mpy-cross.static-amd64-linux-8.0.5"
jobs:
  Compile:
    runs-on: ubuntu-latest
    steps:
      - run: echo "A ${{ github.event_name }} event trigged build of branch ${{ github.ref }}, repository ${{ github.repository }}"
      - name: Check out repository code
        uses: actions/checkout@v3
      - name: install mpy-cross
        run: wget --no-verbose "${{ env.mpy-cross-uri }}" -O ${{ github.workspace }}/mpy-cross; chmod +x ${{ github.workspace }}/mpy-cross
      - run: PATH=.:$PATH make compile
      - name: List build dir
        run: |
          ls -la .compiled/kmk/
      - uses: actions/upload-artifact@v3
        with:
          name: kmk-${{ github.sha }}+mpy-cross-8.0.5
          path: .compiled/kmk/
      - run: echo "${{ job.status }}."
